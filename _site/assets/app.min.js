"use strict";!function(){function e(e){var a="",r=0,o=void 0;for(o in window[e])r>0&&(a+=","),r++,a+=e+":"+o;return a}function a(e){$("#visualisation").width(window.innerWidth);for(var a=d3.time.format("%Y-%m-%d").parse,r={top:40,right:40,bottom:40,left:40},o=$("#visualisation").width(),t=$("#visualisation").height(),n=d3.select("#visualisation"),s=void 0,A=void 0,i=void 0,C=void 0,S=[],I=void 0,c=e.length-1;c>0;c--)S.push({x:a(e[c][0]),y:e[c][1]});d3.selectAll("svg > *").remove(),s=d3.time.scale().domain([new Date(S[0].x),d3.time.day.offset(new Date(S[S.length-1].x),1)]).rangeRound([0,o-r.left-r.right]),A=d3.scale.linear().range([t-r.top-r.bottom,0]).domain([d3.min(S,function(e){return e.y}),d3.max(S,function(e){return e.y})]),i=d3.svg.axis().scale(s).tickSize(1).tickFormat(d3.time.format("%d/%m/%Y")).tickSubdivide(!0),C=d3.svg.axis().scale(A).tickSize(5).orient("left").tickSubdivide(!0),n.append("svg:g").attr("class","x axis").attr("transform","translate("+r.left+","+(t-r.bottom)+")").call(i),n.append("svg:g").attr("class","y axis").attr("transform","translate("+r.left+","+r.top+")").call(C),I=d3.svg.line().x(function(e){return s(e.x)}).y(function(e){return A(e.y)}),n.append("svg:path").attr("d",I(S)).attr("stroke","#00796B").attr("stroke-width",2).attr("transform","translate("+r.left+","+r.top+")").attr("fill","none")}firebase.initializeApp({apiKey:"AIzaSyDOI86ugqPhQf-xx13JoKsEBVohjbxHQXE",authDomain:"stock-market-1b03a.firebaseapp.com",databaseURL:"https://stock-market-1b03a.firebaseio.com",storageBucket:"stock-market-1b03a.appspot.com",messagingSenderId:"916245876277"});var r={updateInterval:6e4,googleBaseUrl:"https://finance.google.com/finance/info",quandlBaseUrl:"https://www.quandl.com/api/v3/datasets/GOOG/",quandlApiKey:"gHKV9BzNmyAVyyaQNJGT"};angular.module("app",["ngResource","firebase"]).controller("ctrl",["$scope","$firebaseObject","$firebaseAuth","$resource","$http",function(o,t,n,s,A){function i(a){var o=e(a.toUpperCase()),t=s(r.googleBaseUrl,{client:"ig",callback:"JSON_CALLBACK"},{get:{method:"JSONP",params:{q:o},isArray:!0}});return t.get()}function C(){o.quotesFTSE=i("FTSE"),o.quotesNASDAQ=i("NASDAQ")}var S=firebase.database().ref(),I=S.child("currentUser"),c=t(I);o.currentUser=c,c.$bindTo(o,"currentUser"),o.currentUser=t(I),o.signUp=function(){firebase.auth().createUserWithEmailAndPassword(o.email,o.password).catch(function(e){e.code;o.errorMessage=e.message,console.error(e.code),console.error(e.message)})},o.logIn=function(){firebase.auth().signInWithEmailAndPassword(o.email,o.password).then(function(){o.user=firebase.auth().currentUser.providerData[0],o.$apply(),console.log(o.user),console.log("Sign-in provider: "+o.user.providerId),console.log("  Provider-specific UID: "+o.user.uid),console.log("  Name: "+o.user.displayName),console.log("  Email: "+o.user.email),console.log("  Photo URL: "+o.user.photoURL)}).catch(function(e){e.code;o.errorMessage=e.message,o.$apply(),console.error(e.code),console.error(e.message)})},o.sell=function(e){o.currentUser.balance=parseInt(o.currentUser.balance,10)+parseInt(o.currentUser.transactions.open[e].marketValue,10),o.currentUser.transactions.closed.push(o.currentUser.transactions.open[e]),o.currentUser.transactions.open.splice(e,1)},o.NASDAQ=NASDAQ,o.FTSE=FTSE,o.currentUser=CURRENT_USER,o.view="quotes",C(),setInterval(function(){C()},r.updateInterval),o.normaliseCompanyName=function(e){e=e.split(" ");for(var a=0;a<e.length;a++)e[a]=e[a][0].toUpperCase()+e[a].substring(1).toLowerCase();return e.join(" ")},o.getCompany=function(e){var t=void 0,n=void 0,s=void 0;void 0!==e&&(o.currentCompany=e,o.timeSpan=366),o.timeSpan>366?(t="weekly",o.timeSpan=Math.floor(o.timeSpan/7)):t="daily",n=NASDAQ[o.currentCompany]?"NASDAQ":"LON",s=""+r.quandlBaseUrl+n+"_"+o.currentCompany+".json",A({method:"GET",url:s,params:{api_key:r.quandlApiKey,rows:o.timeSpan,column_index:4,collapse:t}}).then(function(e){o.company=e.data.dataset,setTimeout(function(){a(o.company.data)},0)},function(e){console.error(e)})},o.concat=function(e,a){return[].concat(e,a)},$(window).resize(function(){a(o.company.data)}),$(window).change(function(){a(o.company.data)}),$("svg").resize(function(){a(o.company.data)}),$("svg").change(function(){a(o.company.data)})}])}();var CURRENT_USER={name:"Maciej Caputa",balance:"100000",avatar:"https://maciejcaputa.com/assets/images/thumbnail-face.jpg",transactions:{open:[{symbol:"AAPL",name:"Apple Inc.",price:{open:113.05},shares:90,date:""},{symbol:"GOOGL",name:"Alphabet Inc Class A",price:{open:801.23},shares:12,date:""},{symbol:"MSFT",name:"Microsoft Corp",price:{open:57.96},shares:175,date:""}],closed:[{symbol:"AMZN",name:"Amazon.com Inc.",price:{open:737.61,close:844.36},shares:10,date:""},{symbol:"NFLX",name:"Netflix Inc.",price:{open:82.79,close:106.28},shares:100,date:""}]}},FTSE={ADN:"Aberdeen Asset Management",ADM:"Admiral Group",AGK:"Aggreko",AMEC:"AMEC",AAL:"Anglo American plc",ANTO:"Antofagasta",ABF:"Associated British Foods",AZN:"AstraZeneca",AV:"Aviva",BAB:"Babcock International",BA:"BAE Systems",BARC:"Barclays",BLT:"BHP Billiton",BP:"BP",BTI:"British American Tobacco",BLND:"British Land Co",BSY:"BSkyB",BT_A:"BT Group",BNZL:"Bunzl",BRBY:"Burberry Group",CPI:"Capita",CUK:"Carnival plc",CNA:"Centrica",CCH:"Coca-Cola HBC AG",CPG:"Compass Group",CRH:"CRH plc",CRDA:"Croda International",DGE:"Diageo",EVR:"Evraz",EXPN:"Experian",FRES:"Fresnillo plc",GFS:"G4S",GKN:"GKN",GSK:"GlaxoSmithKline",GLEN:"Glencore International",HMSO:"Hammerson",HL:"Hargreaves Lansdown",HSBA:"HSBC",IMI:"IMI plc",IMT:"Imperial Tobacco Group",IHG:"InterContinental Hotels Group",IAG:"International Consolidated Airlines Group SA",ITRK:"Intertek Group",ITV:"ITV plc",SBRY:"J Sainsbury plc",JMAT:"Johnson Matthey",KGF:"Kingfisher plc",LAND:"Land Securities Group",LGEN:"Legal & General",LLOY:"Lloyds Banking Group",MKS:"Marks & Spencer Group",MGGT:"Meggitt",MRO:"Melrose plc",MRW:"Morrison Supermarkets",NG:"National Grid plc",NXT:"Next plc",OML:"Old Mutual",PSO:"Pearson plc",PFC:"Petrofac",PRU:"Prudential plc",RRS:"Randgold Resources",RB:"Reckitt Benckiser",REL:"Reed Elsevier",RIO:"Rio Tinto Group",RR:"Rolls-Royce Group",RBS:"Royal Bank of Scotland Group",RDSA:"Royal Dutch Shell",RSA:"RSA Insurance Group",SAB:"SABMiller",SGE:"Sage Group",SDR:"Schroders",SRP:"Serco",SVT:"Severn Trent",SHPG:"Shire plc",SNN:"Smith & Nephew",SMIN:"Smiths Group",SSE:"SSE plc",STAN:"Standard Chartered",SL:"Standard Life",TATE:"Tate & Lyle",TSCO:"Tesco",TLW:"Tullow Oil",ULVR:"Unilever",UU:"United Utilities",VED:"Vedanta Resources",VOD:"Vodafone Group",WEIR:"Weir Group",WTB:"Whitbread",WOS:"Wolseley plc",WG_:"Wood Group",WPP:"WPP plc"},NASDAQ={FOXA:"21ST CENTRY FOX A CM",FOX:"21ST CENTRY FOX B CM",ATVI:"ACTIVISION BLIZZARD",ADBE:"ADOBE SYSTEMS INC",AKAM:"AKAMAI TECHNOLOGIES",ALXN:"ALEXION PHARM INC",GOOGL:"ALPHABET CL A CMN",GOOG:"ALPHABET CL C CAP",AMZN:"AMAZON.COM INC",AAL:"AMERICAN AIRLINES GP",AMGN:"AMGEN",ADI:"ANALOG DEVICES CMN",AAPL:"APPLE INC.",AMAT:"APPLIED MATERIALS",ADSK:"AUTODESK INC",ADP:"AUTOMATIC DATA PROCS",AVGO:"AVAGO TECHNOLOGIES L",BIDU:"BAIDU INC.",BBBY:"BED BATH & BEYOND",BIIB:"BIOGEN INC CMN",BMRN:"BIOMARIN PHARMACEUT",CHRW:"C.H. ROBINSON WW",CA:"CA INC",CELG:"CELGENE CORP",CERN:"CERNER CORP",CHTR:"CHARTER COMMUNICATIO",CHKP:"CHECK POINT SOFTWARE",CSCO:"CISCO SYSTEMS INC",CTXS:"CITRIX SYSTEMS INC",CTSH:"COGNIZANT TECH SOL",CMCSA:"COMCAST CORP A",COST:"COSTCO WHOLESALE",DISCA:"DISCOVERY COMM A",DISCK:"DISCOVERY COMM INC",DISH:"DISH NETWORK CORP",DLTR:"DOLLAR TREE INC",EBAY:"EBAY INC.",EA:"ELECTRONIC ARTS INC",EXPD:"EXPEDITORS INTL",ESRX:"EXPRESS SCRIPTS",FB:"FACEBOOK INC",FAST:"FASTENAL CO",FISV:"FISERV INC.",GRMN:"GARMIN LTD",GILD:"GILEAD SCIENCES INC",HSIC:"HENRY SCHEIN INC.",ILMN:"ILLUMINA INC.",INCY:"INCYTE CORPORATION",INTC:"INTEL CORP",INTU:"INTUIT INC",ISRG:"INTUITIVE SURG INC.",JD:"JD.COM INC. ADS",KLAC:"K L A-TENCOR CORP",GMCR:"KEURIG GREEN MTN CMN",KHC:"KRAFT HEINZ CO CMN",LRCX:"LAM RESEARCH CORP",LBTYA:"LIBERTY GLOBAL ORD A",LBTYK:"LIBERTY GLOBAL ORD C",QVCA:"LIBERTY INT QVC SR A",LILA:"LIBERTY LILAC CL A",LILAK:"LIBERTY LILAC CL C",LMCK:"LIBERTY MEDIA C",LMCA:"LIBERTY MEDIA SRS A",LVNTA:"LIBERTY VNTRS SRS A",LLTC:"LINEAR TECHNOLOGY",MAR:"MARRIOT INT CL A",MAT:"MATTEL INC",MU:"MICRON TECHNOLOGY",MSFT:"MICROSOFT CORP",MDLZ:"MONDELEZ INTL CMN A",MNST:"MONSTER BEVERAGE CP",MYL:"MYLAN NV ORD SHS",NTAP:"NETAPP INC.",NFLX:"NETFLIX INC.",NVDA:"NVIDIA CORPORATION",NXPI:"NXP SEMICONDUCTORS",ORLY:"O'REILLY AUTOMOTIVE",PCAR:"PACCAR INC.",PAYX:"PAYCHEX INC.",QCOM:"QUALCOMM INC",REGN:"REGENERON PHARMACEUT",ROST:"ROSS STORES INC.",SNDK:"SANDISK CORPORATION",SBAC:"SBA COMMUNICATIONS",STX:"SEAGATE TECHNOLOGY",SIRI:"SIRIUS XM HOLDINGS I",SWKS:"SKYWORKS SOLUTIONS",SPLS:"STAPLES INC.",SBUX:"STARBUCKS CORP",SRCL:"STERICYCLE INC.",SYMC:"SYMANTEC CORPORATION",TSLA:"TESLA MOTORS INC",TXN:"TEXAS INSTRUMENTS",PCLN:"THE PRICELINE GP CM",TSCO:"TRACTOR SUPPLY CO",TRIP:"TRIPADVISOR INC.",VRSK:"VERISK ANALYTICS INC",VRTX:"VERTEX PHARMACEUTIC",VIAB:"VIACOM INC CL B",VIP:"VIMPELCOM LTD",VOD:"VODAFONE GRP PLC ADS",WBA:"WALGREENS BTS ALN CM",WDC:"WESTERN DIGITAL CP",WFM:"WHOLE FOODS MARKET",WYNN:"WYNN RESORTS LIMITED",XLNX:"XILINX INC.",YHOO:"YAHOO! INC."};