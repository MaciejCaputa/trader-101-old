"use strict";!function(){function e(e){var a="",n=0,t=void 0;for(t in window[e])n>0&&(a+=","),n++,a+=e+":"+t;return a}function a(e){$("#visualisation").width(window.innerWidth);for(var a=d3.time.format("%Y-%m-%d").parse,n={top:40,right:40,bottom:40,left:40},t=$("#visualisation").width(),o=$("#visualisation").height(),r=d3.select("#visualisation"),s=void 0,i=void 0,c=void 0,A=void 0,l=[],C=void 0,S=e.length-1;S>0;S--)l.push({x:a(e[S][0]),y:e[S][1]});d3.selectAll("svg > *").remove(),s=d3.time.scale().domain([new Date(l[0].x),d3.time.day.offset(new Date(l[l.length-1].x),1)]).rangeRound([0,t-n.left-n.right]),i=d3.scale.linear().range([o-n.top-n.bottom,0]).domain([d3.min(l,function(e){return e.y}),d3.max(l,function(e){return e.y})]),c=d3.svg.axis().scale(s).tickSize(1).tickFormat(d3.time.format("%d/%m/%Y")).tickSubdivide(!0),A=d3.svg.axis().scale(i).tickSize(5).orient("left").tickSubdivide(!0),r.append("svg:g").attr("class","x axis").attr("transform","translate("+n.left+","+(o-n.bottom)+")").call(c),r.append("svg:g").attr("class","y axis").attr("transform","translate("+n.left+","+n.top+")").call(A),C=d3.svg.line().x(function(e){return s(e.x)}).y(function(e){return i(e.y)}),r.append("svg:path").attr("d",C(l)).attr("stroke","#00796B").attr("stroke-width",2).attr("transform","translate("+n.left+","+n.top+")").attr("fill","none")}firebase.initializeApp({apiKey:"AIzaSyDOI86ugqPhQf-xx13JoKsEBVohjbxHQXE",authDomain:"stock-market-1b03a.firebaseapp.com",databaseURL:"https://stock-market-1b03a.firebaseio.com",storageBucket:"stock-market-1b03a.appspot.com",messagingSenderId:"916245876277"});var n={updateInterval:6e4,googleBaseUrl:"https://finance.google.com/finance/info",quandlBaseUrl:"https://www.quandl.com/api/v3/datasets/GOOG/",quandlApiKey:"gHKV9BzNmyAVyyaQNJGT"};angular.module("app",["ngResource","firebase"]).factory("apiRealTimeQuotes",["$resource",function(e){function a(e){var a="",n=0,t=void 0;for(t in window[e])n>0&&(a+=","),n++,a+=e+":"+t;return a}function t(t){var o=a(t.toUpperCase()),r=e(n.googleBaseUrl,{client:"ig",callback:"JSON_CALLBACK"},{get:{method:"JSONP",params:{q:o},isArray:!0}});return r.get(0)}var o=t("FTSE"),r=t("NASDAQ");[].concat(o,r);return o}]).factory("apiHistoricQuotes",["clientId",function(e){$scope.getCompany=function(e){var t=void 0,o=void 0,r=void 0;void 0!==e&&($scope.currentCompany=e,$scope.timeSpan=366),$scope.timeSpan>366?(t="weekly",$scope.timeSpan=Math.floor($scope.timeSpan/7)):t="daily",o=NASDAQ[$scope.currentCompany]?"NASDAQ":"LON",r=""+n.quandlBaseUrl+o+"_"+$scope.currentCompany+".json",$http({method:"GET",url:r,params:{api_key:n.quandlApiKey,rows:$scope.timeSpan,column_index:4,collapse:t}}).then(function(e){return a(e.data.dataset),e.data.dataset}).then(function(){a($scope.company.data)}).catch(function(e){return console.error(e),null})}}]).controller("ctrl",["$scope","$firebaseObject","$firebaseAuth","$resource","$http","apiRealTimeQuotes",function(t,o,r,s,i,c){function A(a){var n=e(a.toUpperCase());return i.jsonp("https://finance.google.com/finance/info?client=ig&q="+n+"&callback=JSON_CALLBACK").then(function(e){var a=e.data;for(var n in a){var t=a[n];a[n]={symbol:t.t,name:NASDAQ.hasOwnProperty(t.t)?NASDAQ[t.t]:FTSE[t.t],level:parseFloat("LON"==t.e?t.l.replace(",","")/100:t.l),change:parseFloat(t.c,10),changePercent:parseFloat(t.cp),timestamp:new Date(t.lt_dts),market:"LON"==t.e?"FTSE 100":"NASDAQ 100"}}return console.log(a),a}).catch(function(e){console.error(e)})}function l(){var e=void 0,a=void 0;A("FTSE").then(function(a){e=a,console.info("quotes"),console.info(a),console.info("quotes")}),A("NASDAQ").then(function(e){a=e,console.info("quotes"),console.info(e),console.info("quotes")}).then(function(){t.quotes=[].concat(e,a)})}t.login={},t.signup={},t.quotes=[],t.user=firebase.auth().currentUser,t.signUp=function(){firebase.auth().createUserWithEmailAndPassword(t.signup.email,t.signup.password).then(function(){firebase.auth().currentUser.updateProfile({displayName:t.signup.firstName+" "+t.signup.lastName,photoURL:"https://maciejcaputa.com/assets/images/thumbnail-face.jpg"}).then(function(){firebase.database().ref("users/"+firebase.auth().currentUser.uid).set({firstName:t.signup.firstName,lastName:t.signup.lastName,name:t.signup.firstName+" "+t.signup.lastName,email:t.signup.email,avatar:"https://maciejcaputa.com/assets/images/thumbnail-face.jpg",balance:1e4,transactions:{open:[{symbol:"AAPL",name:"Apple Inc.",price:{open:113.05},shares:90,date:""},{symbol:"GOOGL",name:"Alphabet Inc Class A",price:{open:801.23},shares:12,date:""},{symbol:"MSFT",name:"Microsoft Corp",price:{open:57.96},shares:175,date:""}],closed:[{symbol:"AMZN",name:"Amazon.com Inc.",price:{open:737.61,close:844.36},shares:10,date:""},{symbol:"NFLX",name:"Netflix Inc.",price:{open:82.79,close:106.28},shares:100,date:""}]}})}).then(function(){firebase.database().ref("/users/"+firebase.auth().currentUser.uid).once("value").then(function(e){t.user=e.val(),t.view="quotes",t.$apply(),console.info("--- LOG IN SUCCEEDED ---"),console.info(t.user)})})}).catch(function(e){t.signup.errorMessage=e.message,t.$apply(),console.error("--- SIGN UP FAILED ---"),console.error(e.code),console.error(e.message)})},t.logIn=function(){firebase.auth().signInWithEmailAndPassword(t.login.email,t.login.password).then(function(){firebase.database().ref("/users/"+firebase.auth().currentUser.uid).once("value").then(function(e){t.user=e.val(),t.$apply(),console.info("--- LOG IN SUCCEEDED ---"),console.info(t.user)})}).catch(function(e){t.login.errorMessage=e.message,t.$apply(),console.error("--- LOG IN FAILED ---"),console.error(e.code),console.error(e.message)})},t.buy=function(e,a){firebase.database().ref("users/"+firebase.auth().currentUser.uid+"/transactions/open").push({symbol:e.symbol,name:e.name,price:{open:e.level},shares:a,date:(new Date).now()})},t.sell=function(e){t.currentUser.balance=parseInt(t.currentUser.balance,10)+parseInt(t.currentUser.transactions.open[e].marketValue,10),t.currentUser.transactions.closed.push(t.currentUser.transactions.open[e]),t.currentUser.transactions.open.splice(e,1)},t.NASDAQ=NASDAQ,t.FTSE=FTSE,t.view="quotes",l(),setInterval(function(){l()},n.updateInterval),t.normaliseCompanyName=function(e){e=e.split(" ");for(var a=0;a<e.length;a++)e[a]=e[a][0].toUpperCase()+e[a].substring(1).toLowerCase();return e.join(" ")},t.getCompany=function(e){var o=void 0,r=void 0,s=void 0;void 0!==e&&(t.currentCompany=e,t.timeSpan=366),t.timeSpan>366?(o="weekly",t.timeSpan=Math.floor(t.timeSpan/7)):o="daily",r=NASDAQ[t.currentCompany]?"NASDAQ":"LON",s=""+n.quandlBaseUrl+r+"_"+t.currentCompany+".json",i({method:"GET",url:s,params:{api_key:n.quandlApiKey,rows:t.timeSpan,column_index:4,collapse:o}}).then(function(e){t.company=e.data.dataset,setTimeout(function(){a(t.company.data)},0)},function(e){console.error(e)})},t.concat=function(e,a){return[].concat(e,a)},$(window).resize(function(){a(t.company.data)}),$(window).change(function(){a(t.company.data)}),$("svg").resize(function(){a(t.company.data)}),$("svg").change(function(){a(t.company.data)})}])}();var CURRENT_USER={name:"Maciej Caputa",balance:"100000",avatar:"https://maciejcaputa.com/assets/images/thumbnail-face.jpg",transactions:{open:[{symbol:"AAPL",name:"Apple Inc.",price:{open:113.05},shares:90,date:""},{symbol:"GOOGL",name:"Alphabet Inc Class A",price:{open:801.23},shares:12,date:""},{symbol:"MSFT",name:"Microsoft Corp",price:{open:57.96},shares:175,date:""}],closed:[{symbol:"AMZN",name:"Amazon.com Inc.",price:{open:737.61,close:844.36},shares:10,date:""},{symbol:"NFLX",name:"Netflix Inc.",price:{open:82.79,close:106.28},shares:100,date:""}]}},FTSE={ADN:"Aberdeen Asset Management",ADM:"Admiral Group",AGK:"Aggreko",AMEC:"AMEC",AAL:"Anglo American plc",ANTO:"Antofagasta",ABF:"Associated British Foods",AZN:"AstraZeneca",AV:"Aviva",BAB:"Babcock International",BA:"BAE Systems",BARC:"Barclays",BLT:"BHP Billiton",BP:"BP",BTI:"British American Tobacco",BLND:"British Land Co",BSY:"BSkyB",BT_A:"BT Group",BNZL:"Bunzl",BRBY:"Burberry Group",CPI:"Capita",CUK:"Carnival plc",CNA:"Centrica",CCH:"Coca-Cola HBC AG",CPG:"Compass Group",CRH:"CRH plc",CRDA:"Croda International",DGE:"Diageo",EVR:"Evraz",EXPN:"Experian",FRES:"Fresnillo plc",GFS:"G4S",GKN:"GKN",GSK:"GlaxoSmithKline",GLEN:"Glencore International",HMSO:"Hammerson",HL:"Hargreaves Lansdown",HSBA:"HSBC",IMI:"IMI plc",IMT:"Imperial Tobacco Group",IHG:"InterContinental Hotels Group",IAG:"International Consolidated Airlines Group SA",ITRK:"Intertek Group",ITV:"ITV plc",SBRY:"J Sainsbury plc",JMAT:"Johnson Matthey",KGF:"Kingfisher plc",LAND:"Land Securities Group",LGEN:"Legal & General",LLOY:"Lloyds Banking Group",MKS:"Marks & Spencer Group",MGGT:"Meggitt",MRO:"Melrose plc",MRW:"Morrison Supermarkets",NG:"National Grid plc",NXT:"Next plc",OML:"Old Mutual",PSO:"Pearson plc",PFC:"Petrofac",PRU:"Prudential plc",RRS:"Randgold Resources",RB:"Reckitt Benckiser",REL:"Reed Elsevier",RIO:"Rio Tinto Group",RR:"Rolls-Royce Group",RBS:"Royal Bank of Scotland Group",RDSA:"Royal Dutch Shell",RSA:"RSA Insurance Group",SAB:"SABMiller",SGE:"Sage Group",SDR:"Schroders",SRP:"Serco",SVT:"Severn Trent",SHPG:"Shire plc",SNN:"Smith & Nephew",SMIN:"Smiths Group",SSE:"SSE plc",STAN:"Standard Chartered",SL:"Standard Life",TATE:"Tate & Lyle",TSCO:"Tesco",TLW:"Tullow Oil",ULVR:"Unilever",UU:"United Utilities",VED:"Vedanta Resources",VOD:"Vodafone Group",WEIR:"Weir Group",WTB:"Whitbread",WOS:"Wolseley plc",WG_:"Wood Group",WPP:"WPP plc"},NASDAQ={FOXA:"21ST CENTRY FOX A CM",FOX:"21ST CENTRY FOX B CM",ATVI:"ACTIVISION BLIZZARD",ADBE:"ADOBE SYSTEMS INC",AKAM:"AKAMAI TECHNOLOGIES",ALXN:"ALEXION PHARM INC",GOOGL:"ALPHABET CL A CMN",GOOG:"ALPHABET CL C CAP",AMZN:"AMAZON.COM INC",AAL:"AMERICAN AIRLINES GP",AMGN:"AMGEN",ADI:"ANALOG DEVICES CMN",AAPL:"APPLE INC.",AMAT:"APPLIED MATERIALS",ADSK:"AUTODESK INC",ADP:"AUTOMATIC DATA PROCS",AVGO:"AVAGO TECHNOLOGIES L",BIDU:"BAIDU INC.",BBBY:"BED BATH & BEYOND",BIIB:"BIOGEN INC CMN",BMRN:"BIOMARIN PHARMACEUT",CHRW:"C.H. ROBINSON WW",CA:"CA INC",CELG:"CELGENE CORP",CERN:"CERNER CORP",CHTR:"CHARTER COMMUNICATIO",CHKP:"CHECK POINT SOFTWARE",CSCO:"CISCO SYSTEMS INC",CTXS:"CITRIX SYSTEMS INC",CTSH:"COGNIZANT TECH SOL",CMCSA:"COMCAST CORP A",COST:"COSTCO WHOLESALE",DISCA:"DISCOVERY COMM A",DISCK:"DISCOVERY COMM INC",DISH:"DISH NETWORK CORP",DLTR:"DOLLAR TREE INC",EBAY:"EBAY INC.",EA:"ELECTRONIC ARTS INC",EXPD:"EXPEDITORS INTL",ESRX:"EXPRESS SCRIPTS",FB:"FACEBOOK INC",FAST:"FASTENAL CO",FISV:"FISERV INC.",GRMN:"GARMIN LTD",GILD:"GILEAD SCIENCES INC",HSIC:"HENRY SCHEIN INC.",ILMN:"ILLUMINA INC.",INCY:"INCYTE CORPORATION",INTC:"INTEL CORP",INTU:"INTUIT INC",ISRG:"INTUITIVE SURG INC.",JD:"JD.COM INC. ADS",KLAC:"K L A-TENCOR CORP",GMCR:"KEURIG GREEN MTN CMN",KHC:"KRAFT HEINZ CO CMN",LRCX:"LAM RESEARCH CORP",LBTYA:"LIBERTY GLOBAL ORD A",LBTYK:"LIBERTY GLOBAL ORD C",QVCA:"LIBERTY INT QVC SR A",LILA:"LIBERTY LILAC CL A",LILAK:"LIBERTY LILAC CL C",LMCK:"LIBERTY MEDIA C",LMCA:"LIBERTY MEDIA SRS A",LVNTA:"LIBERTY VNTRS SRS A",LLTC:"LINEAR TECHNOLOGY",MAR:"MARRIOT INT CL A",MAT:"MATTEL INC",MU:"MICRON TECHNOLOGY",MSFT:"MICROSOFT CORP",MDLZ:"MONDELEZ INTL CMN A",MNST:"MONSTER BEVERAGE CP",MYL:"MYLAN NV ORD SHS",NTAP:"NETAPP INC.",NFLX:"NETFLIX INC.",NVDA:"NVIDIA CORPORATION",NXPI:"NXP SEMICONDUCTORS",ORLY:"O'REILLY AUTOMOTIVE",PCAR:"PACCAR INC.",PAYX:"PAYCHEX INC.",QCOM:"QUALCOMM INC",REGN:"REGENERON PHARMACEUT",ROST:"ROSS STORES INC.",SNDK:"SANDISK CORPORATION",SBAC:"SBA COMMUNICATIONS",STX:"SEAGATE TECHNOLOGY",SIRI:"SIRIUS XM HOLDINGS I",SWKS:"SKYWORKS SOLUTIONS",SPLS:"STAPLES INC.",SBUX:"STARBUCKS CORP",SRCL:"STERICYCLE INC.",SYMC:"SYMANTEC CORPORATION",TSLA:"TESLA MOTORS INC",TXN:"TEXAS INSTRUMENTS",PCLN:"THE PRICELINE GP CM",TSCO:"TRACTOR SUPPLY CO",TRIP:"TRIPADVISOR INC.",VRSK:"VERISK ANALYTICS INC",VRTX:"VERTEX PHARMACEUTIC",VIAB:"VIACOM INC CL B",VIP:"VIMPELCOM LTD",VOD:"VODAFONE GRP PLC ADS",WBA:"WALGREENS BTS ALN CM",WDC:"WESTERN DIGITAL CP",WFM:"WHOLE FOODS MARKET",WYNN:"WYNN RESORTS LIMITED",XLNX:"XILINX INC.",YHOO:"YAHOO! INC."};